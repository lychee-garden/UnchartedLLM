# UnchartedLLM Chatbot

å®æ—¶äº¤äº’å¼ Chatbot ç³»ç»Ÿï¼Œæ”¯æŒåŠ¨æ€ Target æ§åˆ¶å’Œå¯è§†åŒ–åˆ†æã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
chatbot/
â”œâ”€â”€ backend.py              # åç«¯æœåŠ¡å™¨ (WebSocket API)
â”œâ”€â”€ frontend.html           # å‰ç«¯ç•Œé¢ (Web UI)
â”œâ”€â”€ start_chatbot.sh        # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ requirements.txt        # Python ä¾èµ–
â””â”€â”€ README.md              # æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install aiohttp aiohttp-cors
```

### 2. é…ç½®æ¨¡å‹è·¯å¾„

ç¼–è¾‘ `start_chatbot.sh`ï¼Œä¿®æ”¹ä»¥ä¸‹å˜é‡ï¼š

```bash
# æ¨¡å‹è·¯å¾„ (è®­ç»ƒå¥½çš„ checkpoint)
MODEL_PATH="/path/to/your/checkpoint.bin"

# åŸºç¡€æ¨¡å‹è·¯å¾„
BASE_MODEL="/path/to/Qwen3-8B"

# æœåŠ¡å™¨ç«¯å£
PORT=8765
```

### 3. å¯åŠ¨æœåŠ¡å™¨

```bash
cd /home/wanghaoxiao/temp_lizhiyuan/Qwen3/UnchartedLLM/chatbot
bash start_chatbot.sh
```

### 4. SSH ç«¯å£è½¬å‘ (è¿œç¨‹è®¿é—®)

åœ¨**æœ¬åœ°æœºå™¨**ä¸Šè¿è¡Œï¼š

```bash
ssh -L 8765:localhost:8765 user@remote_host
```

ç„¶ååœ¨æœ¬åœ°æµè§ˆå™¨æ‰“å¼€ï¼š

```
http://localhost:8765
```

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### åç«¯ API (backend.py)

#### 1. æ¨¡å‹è¾“å‡º API

æ¯ä¸€æ­¥ç”Ÿæˆï¼Œåç«¯æä¾›ä»¥ä¸‹æ•°æ®ï¼š

```python
{
    "step": 0,                          # å½“å‰æ­¥æ•°
    "token_id": 123,                    # æ–° token ID
    "token_text": "Hello",              # æ–° token æ–‡æœ¬
    "input_target_vector": [...],       # è¾“å…¥ target å‘é‡ (å‰10ç»´)
    "output_target_vector": [...],      # è¾“å‡º target å‘é‡ (å‰10ç»´)
    "input_target_value": 100.0,        # è¾“å…¥ target æ•°å€¼
    "output_target_value": 99.5,        # è¾“å‡º target æ•°å€¼ (predicted)
    "output_target_norm": 156.8,        # è¾“å‡º target æ¨¡é•¿
    "cosine_similarity": 0.9987,        # Cosine ç›¸ä¼¼åº¦
    "total_tokens": 1,                  # å·²è¾“å‡º token æ•°
    "planned_target_value": 99.0,       # è§„åˆ’çš„ target æ•°å€¼
    "control_strategy": "planned"       # å½“å‰æ§åˆ¶ç­–ç•¥ ("planned" æˆ– "predicted")
}
```

#### 2. è®¡ç®—æŒ‡æ ‡

åç«¯è‡ªåŠ¨è®¡ç®—ä»¥ä¸‹æŒ‡æ ‡ï¼š

- **è¾“å…¥ target æ•°å€¼**: `value = ||embedding|| / (Î± Â· ||base_embedding||)`
- **è¾“å‡º target æ•°å€¼**: åŒä¸Š
- **è¾“å‡º target æ¨¡é•¿**: `||predicted_embedding||`
- **Cosine ç›¸ä¼¼åº¦**: `cos(predicted_embedding, base_embedding)`

#### 3. æ•°æ®ä¿å­˜

æ‰€æœ‰æ­¥éª¤çš„æ•°æ®éƒ½ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œç”Ÿæˆç»“æŸåè¿”å›å®Œæ•´å†å²ï¼š

```python
{
    "type": "complete",
    "history": [
        {...},  # Step 0
        {...},  # Step 1
        ...
    ]
}
```

#### 4. åŠ¨æ€ Target æ§åˆ¶

æ”¯æŒåœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­åŠ¨æ€ä¿®æ”¹ target å€¼ï¼š

```python
# å‰ç«¯å‘é€ä¿®æ”¹è¯·æ±‚
{
    "type": "modify",
    "value": 50.0
}

# åç«¯ç¡®è®¤
{
    "type": "modify_ack",
    "value": 50.0
}
```

#### 5. API æ§åˆ¶è§„åˆ’ (æ–°å¢)

æ”¯æŒé€šè¿‡æ§åˆ¶ç‚¹å®šä¹‰ target è¾“å…¥ç­–ç•¥ï¼š

```python
# å‰ç«¯å‘é€ç”Ÿæˆè¯·æ±‚ï¼ˆåŒ…å«æ§åˆ¶å‚æ•°ï¼‰
{
    "type": "generate",
    "prompt": "Once upon a time",
    "initial_target": 100,
    "max_length": 512,
    "temperature": 1.0,
    "top_k": 50,
    "top_p": 0.9,
    "control_points": [[0, 1], [1, 0]],  # æ§åˆ¶ç‚¹æ•°ç»„
    "control_strategy": "full",           # æ§åˆ¶ç­–ç•¥: "none", "partial", "full"
    "compelling_steps": 50                # å¼ºåˆ¶æ§åˆ¶æ­¥æ•°ï¼ˆä»… partial ç­–ç•¥ï¼‰
}
```

**æ§åˆ¶ç‚¹æ ¼å¼**:
- æ¨ªåæ ‡ (x): å·²è¾“å‡º token æ•° / initial_targetï¼ˆå½’ä¸€åŒ–ï¼‰
- çºµåæ ‡ (y): è¾“å…¥ target å€¼ / initial_targetï¼ˆå½’ä¸€åŒ–ï¼‰
- ç¤ºä¾‹: `[[0, 1], [1, 0]]` è¡¨ç¤ºçº¿æ€§é€’å‡ï¼ˆæ–œç‡ = -1ï¼‰

**æ§åˆ¶ç­–ç•¥**:
- `none`: ä¸ä½¿ç”¨è§„åˆ’ï¼Œå®Œå…¨ä½¿ç”¨ predicted_target - 1
- `partial`: å‰ compelling_steps æ­¥ä½¿ç”¨è§„åˆ’ï¼Œä¹‹åä½¿ç”¨ predicted_target - 1
- `full`: å…¨ç¨‹ä½¿ç”¨è§„åˆ’çš„ target

**æ§åˆ¶é€»è¾‘**:

```python
# è®¡ç®—è§„åˆ’çš„ target
planned_target = planner.get_planned_target(total_tokens)

# æ ¹æ®æ§åˆ¶ç­–ç•¥é€‰æ‹©
if control_strategy == "full":
    next_target_value = planned_target
elif control_strategy == "partial" and step < compelling_steps:
    next_target_value = planned_target
else:
    next_target_value = predicted_value - 1

# å¦‚æœæœ‰ä¿®æ”¹è¯·æ±‚ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
if modify_request:
    next_target_value = modify_value

next_target_embedding = value_to_embedding(next_target_value)
```

### å‰ç«¯ç•Œé¢ (frontend.html)

#### 1. å®æ—¶æ›´æ–° (æ¯ 0.1 ç§’)

å‰ç«¯é€šè¿‡ WebSocket å®æ—¶æ¥æ”¶æ•°æ®ï¼Œå¹¶æ›´æ–°ï¼š

- âœ… æœ€æ–°ç”Ÿæˆçš„ token (è¿½åŠ åˆ°è¾“å‡ºæœ«å°¾)
- âœ… æœ€æ–°çš„è¾“å‡º target æ•°å€¼
- âœ… æœ€æ–°çš„ cosine ç›¸ä¼¼åº¦
- âœ… å·²è¾“å‡ºçš„ token æ•°

#### 2. å®æ—¶ç»Ÿè®¡é¢æ¿

æ˜¾ç¤º 4 ä¸ªå…³é”®æŒ‡æ ‡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·²è¾“å‡º Token æ•° â”‚ è¾“å‡º Target æ•°å€¼â”‚
â”‚      42         â”‚     58.23       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Cosine ç›¸ä¼¼åº¦   â”‚   å½“å‰æ­¥æ•°      â”‚
â”‚    0.9987       â”‚      42         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. å¯è§†åŒ–å›¾è¡¨

ç”Ÿæˆç»“æŸåï¼Œè‡ªåŠ¨å±•ç¤º 5 å¹…å›¾è¡¨ï¼š

**å›¾è¡¨ 1: è¾“å‡º Target æ•°å€¼æ›²çº¿**
- æ¨ªè½´: æ­¥æ•°
- çºµè½´: è¾“å‡º target æ•°å€¼ï¼ˆpredictedï¼‰
- æ˜¾ç¤ºæ¨¡å‹é¢„æµ‹çš„ target å€¼éšæ—¶é—´å˜åŒ–

**å›¾è¡¨ 2: Cosine ç›¸ä¼¼åº¦æ›²çº¿**
- æ¨ªè½´: æ­¥æ•°
- çºµè½´: Cosine ç›¸ä¼¼åº¦
- æ–°å¢ç»Ÿè®¡ä¿¡æ¯ï¼šå‡å€¼å’Œæ–¹å·®

**å›¾è¡¨ 3: Target vs å·²è¾“å‡ºToken å…³ç³»å›¾ï¼ˆæ–°å¢ï¼‰**
- æ¨ªè½´: å·²è¾“å‡º token æ•°
- çºµè½´: è¾“å‡º target æ•°å€¼
- æ•£ç‚¹å›¾ + æ‹Ÿåˆç›´çº¿
- æ˜¾ç¤ºæ‹Ÿåˆæ–¹ç¨‹: `y = b + a*x`
- æ˜¾ç¤º MSE æŸå¤±: `L = (1/n) * Î£(y_i - Å·_i)Â²`
- æ˜¾ç¤º RÂ² å†³å®šç³»æ•°
- **å¼ºåˆ¶ X-Y è½´æ¯”ä¾‹å°ºç»Ÿä¸€ï¼ˆ1:1ï¼‰**

**å›¾è¡¨ 4: è¾“å…¥ Target å€¼æ›²çº¿ï¼ˆæ–°å¢ï¼‰**
- æ¨ªè½´: å·²è¾“å‡º token æ•°
- çºµè½´: è¾“å…¥ target å€¼
- æ˜¾ç¤ºå®é™…è¾“å…¥åˆ°æ¨¡å‹çš„ target å€¼
- åæ˜ æ§åˆ¶ç­–ç•¥çš„æ•ˆæœ
- **å¼ºåˆ¶ X-Y è½´æ¯”ä¾‹å°ºç»Ÿä¸€ï¼ˆ1:1ï¼‰**

**å›¾è¡¨ 5: Predicted vs Input Target å¯¹æ¯”ï¼ˆæ–°å¢ï¼‰**
- æ¨ªè½´: å·²è¾“å‡º token æ•°
- çºµè½´: Target å€¼
- åŒçº¿å›¾ï¼šè“è‰²çº¿ï¼ˆPredictedï¼‰+ ç»¿è‰²çº¿ï¼ˆInputï¼‰
- ç›´è§‚å¯¹æ¯”æ§åˆ¶ç­–ç•¥çš„å½±å“
- **å¼ºåˆ¶ X-Y è½´æ¯”ä¾‹å°ºç»Ÿä¸€ï¼ˆ1:1ï¼‰**

#### 4. Target æ§åˆ¶é¢æ¿

ä¸‰ç§æ§åˆ¶æ–¹å¼ï¼š

**æ–¹å¼ 1: åŠ¨æ€ä¿®æ”¹ï¼ˆå®æ—¶æ§åˆ¶ï¼‰**
1. **modify_target_value**: é¢„è®¾æ§åˆ¶å€¼ (è¾“å…¥æ¡†)
2. **Modify æŒ‰é’®**: ç¡®è®¤æ§åˆ¶ (ç‚¹å‡»å‘é€)

ç‚¹å‡» "Modify" åï¼Œåç«¯ç«‹å³æ¥æ”¶å¹¶åº”ç”¨æ–°çš„ target å€¼ã€‚

**æ–¹å¼ 2: API æ§åˆ¶è§„åˆ’ï¼ˆé¢„è®¾æ§åˆ¶ï¼‰**
1. **æ§åˆ¶ç­–ç•¥é€‰æ‹©å™¨**: é€‰æ‹© none/partial/full
2. **å¼ºåˆ¶æ§åˆ¶æ­¥æ•°**: è®¾ç½® compelling_stepsï¼ˆä»… partial ç­–ç•¥ï¼‰
3. **æ§åˆ¶ç‚¹è¾“å…¥**: JSON æ ¼å¼å®šä¹‰æ§åˆ¶è“å›¾

**æ–¹å¼ 3: æ··åˆæ§åˆ¶**
- å¯ä»¥åŒæ—¶ä½¿ç”¨è§„åˆ’æ§åˆ¶å’ŒåŠ¨æ€ä¿®æ”¹
- åŠ¨æ€ä¿®æ”¹çš„ä¼˜å…ˆçº§é«˜äºè§„åˆ’æ§åˆ¶

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: åŸºæœ¬ç”Ÿæˆ

1. åœ¨ "Prompt" è¾“å…¥æ¡†è¾“å…¥: `"Once upon a time"`
2. è®¾ç½® "Initial Target" ä¸º `100`
3. ç‚¹å‡» "ğŸš€ å¼€å§‹ç”Ÿæˆ"
4. è§‚å¯Ÿå®æ—¶è¾“å‡ºå’Œç»Ÿè®¡æ•°æ®
5. ç”Ÿæˆç»“æŸåæŸ¥çœ‹ 5 ä¸ªå›¾è¡¨

### ç¤ºä¾‹ 2: åŠ¨æ€æ§åˆ¶

1. å¼€å§‹ç”Ÿæˆ (Initial Target = 100)
2. ç”Ÿæˆåˆ°ä¸€åŠæ—¶ï¼Œåœ¨ "Modify Target Value" è¾“å…¥ `50`
3. ç‚¹å‡» "âœï¸ Modify" æŒ‰é’®
4. è§‚å¯Ÿ target æ•°å€¼çš„å˜åŒ–
5. æ¨¡å‹ä¼šæ ¹æ®æ–°çš„ target å€¼è°ƒæ•´ç”Ÿæˆç­–ç•¥

### ç¤ºä¾‹ 3: çº¿æ€§é€’å‡æ§åˆ¶ï¼ˆk=-1ï¼‰

**ç›®æ ‡**: éªŒè¯æ¨¡å‹æ˜¯å¦èƒ½æŒ‰ç…§ k=-1 çš„çº¿æ€§é€’å‡è§„å¾‹ç”Ÿæˆ

**è®¾ç½®**:
1. Initial Target: `100`
2. æ§åˆ¶ç­–ç•¥: `å…¨ç¨‹æ§åˆ¶`
3. æ§åˆ¶ç‚¹: `[[0, 1], [1, 0]]`

**é¢„æœŸç»“æœ**:
- Input Target æ›²çº¿åº”è¯¥æ˜¯å®Œç¾çš„ç›´çº¿
- Predicted Target åº”è¯¥æ¥è¿‘ Input Target
- æ‹Ÿåˆç›´çº¿æ–œç‡åº”è¯¥æ¥è¿‘ -1
- RÂ² åº”è¯¥æ¥è¿‘ 1

### ç¤ºä¾‹ 4: å¿«é€Ÿé€’å‡æ§åˆ¶

**ç›®æ ‡**: æµ‹è¯•å¿«é€Ÿå®Œæˆç”Ÿæˆçš„æ•ˆæœ

**è®¾ç½®**:
1. Initial Target: `100`
2. æ§åˆ¶ç­–ç•¥: `å…¨ç¨‹æ§åˆ¶`
3. æ§åˆ¶ç‚¹: `[[0, 1], [0.5, 0]]`

**é¢„æœŸç»“æœ**:
- å‰ 50 æ­¥å¿«é€Ÿé€’å‡åˆ° 0
- ä¹‹å target ä¿æŒåœ¨ 0
- ç”Ÿæˆå¯èƒ½åœ¨ 50 æ­¥å·¦å³ç»“æŸ

### ç¤ºä¾‹ 5: éƒ¨åˆ†æ§åˆ¶ç­–ç•¥

**ç›®æ ‡**: æµ‹è¯•å‰åŠæ®µæ§åˆ¶ï¼ŒååŠæ®µè‡ªç”±çš„æ•ˆæœ

**è®¾ç½®**:
1. Initial Target: `100`
2. æ§åˆ¶ç­–ç•¥: `éƒ¨åˆ†æ§åˆ¶`
3. å¼ºåˆ¶æ§åˆ¶æ­¥æ•°: `50`
4. æ§åˆ¶ç‚¹: `[[0, 1], [1, 0]]`

**é¢„æœŸç»“æœ**:
- å‰ 50 æ­¥ï¼šInput Target æŒ‰ç›´çº¿é€’å‡
- å 50 æ­¥ï¼šInput Target è·Ÿéš Predicted Target
- å¯¹æ¯”å›¾ä¸­ä¸¤æ¡çº¿åœ¨ç¬¬ 50 æ­¥å¤„åˆ†ç¦»

### ç¤ºä¾‹ 6: å¹³å°æœŸæ§åˆ¶

**ç›®æ ‡**: æµ‹è¯•ä¸­é—´ä¿æŒç¨³å®š target çš„æ•ˆæœ

**è®¾ç½®**:
1. Initial Target: `100`
2. æ§åˆ¶ç­–ç•¥: `å…¨ç¨‹æ§åˆ¶`
3. æ§åˆ¶ç‚¹: `[[0, 1], [0.2, 0.8], [0.8, 0.8], [1, 0]]`

**é¢„æœŸç»“æœ**:
- 0-20 æ­¥ï¼šå¿«é€Ÿé™åˆ° 80
- 20-80 æ­¥ï¼šä¿æŒåœ¨ 80
- 80-100 æ­¥ï¼šå¿«é€Ÿé™åˆ° 0
- Input Target æ›²çº¿å‘ˆç°é˜¶æ¢¯çŠ¶

### ç¤ºä¾‹ 7: å¤šæ¬¡å®éªŒå¯¹æ¯”

1. ç¬¬ä¸€æ¬¡: Initial Target = 50, æ— æ§åˆ¶
2. ç¬¬äºŒæ¬¡: Initial Target = 100, çº¿æ€§é€’å‡æ§åˆ¶
3. ç¬¬ä¸‰æ¬¡: Initial Target = 100, å¿«é€Ÿé€’å‡æ§åˆ¶
4. å¯¹æ¯”ä¸‰æ¬¡å®éªŒçš„å›¾è¡¨ï¼Œåˆ†ææ§åˆ¶æ•ˆæœ

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### WebSocket é€šä¿¡åè®®

#### å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨

**1. å¼€å§‹ç”Ÿæˆ**
```json
{
    "type": "generate",
    "prompt": "Once upon a time",
    "initial_target": 100,
    "max_length": 512,
    "temperature": 1.0,
    "top_k": 50,
    "top_p": 0.9,
    "control_points": [[0, 1], [1, 0]],
    "control_strategy": "full",
    "compelling_steps": 50
}
```

**2. ä¿®æ”¹ Target**
```json
{
    "type": "modify",
    "value": 50.0
}
```

#### æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯

**1. å•æ­¥æ•°æ®**
```json
{
    "type": "step",
    "data": {
        "step": 0,
        "token_id": 123,
        "token_text": "Hello",
        "input_target_vector": [...],
        "output_target_vector": [...],
        "input_target_value": 100.0,
        "output_target_value": 99.5,
        "output_target_norm": 156.8,
        "cosine_similarity": 0.9987,
        "total_tokens": 1,
        "planned_target_value": 99.0,
        "control_strategy": "planned"
    }
}
```

**2. ç”Ÿæˆå®Œæˆ**
```json
{
    "type": "complete",
    "history": [...]
}
```

**3. ä¿®æ”¹ç¡®è®¤**
```json
{
    "type": "modify_ack",
    "value": 50.0
}
```

### æ ¸å¿ƒç®—æ³•

#### 1. Embedding â†’ Value è½¬æ¢

```python
def embedding_to_value(embedding, base_embedding):
    pred_norm = ||embedding||_2
    base_norm = ||base_embedding||_2
    value = pred_norm / (Î± Â· base_norm)
    return value
```

å…¶ä¸­ `Î± = 1/64` (XVAL_ALPHA)

#### 2. Value â†’ Embedding è½¬æ¢

```python
def value_to_embedding(value, base_embedding):
    scaled_value = Î± Â· value
    embedding = scaled_value Â· base_embedding
    return embedding
```

#### 3. Cosine ç›¸ä¼¼åº¦è®¡ç®—

```python
def compute_cosine_similarity(embedding, base_embedding):
    cosine = (embedding Â· base_embedding) / (||embedding|| Â· ||base_embedding||)
    return cosine
```

#### 4. Target è§„åˆ’å™¨ (TargetPlanner)

```python
class TargetPlanner:
    def __init__(self, control_points, initial_target):
        """
        åˆå§‹åŒ–è§„åˆ’å™¨

        Args:
            control_points: [(x1, y1), (x2, y2), ...]
                x: å·²è¾“å‡ºtokenæ•° / initial_target (å½’ä¸€åŒ–)
                y: è¾“å…¥targetå€¼ / initial_target (å½’ä¸€åŒ–)
            initial_target: åˆå§‹targetå€¼
        """
        self.control_points = sorted(control_points, key=lambda p: p[0])
        self.initial_target = initial_target

        # ç¡®ä¿ç¬¬ä¸€ä¸ªç‚¹æ˜¯ (0, 1)
        if self.control_points[0] != (0.0, 1.0):
            self.control_points.insert(0, (0.0, 1.0))

        # ç¡®ä¿æœ€åä¸€ä¸ªç‚¹çš„yå€¼ä¸º0
        if self.control_points[-1][1] != 0.0:
            last_x = self.control_points[-1][0]
            self.control_points.append((last_x, 0.0))

    def get_planned_target(self, total_tokens):
        """
        æ ¹æ®å·²è¾“å‡ºtokenæ•°è®¡ç®—è§„åˆ’çš„targetå€¼
        ä½¿ç”¨çº¿æ€§æ’å€¼
        """
        x_normalized = total_tokens / self.initial_target

        # çº¿æ€§æ’å€¼
        for i in range(len(self.control_points) - 1):
            x1, y1 = self.control_points[i]
            x2, y2 = self.control_points[i + 1]

            if x1 <= x_normalized <= x2:
                if x2 == x1:
                    y_normalized = y1
                else:
                    t = (x_normalized - x1) / (x2 - x1)
                    y_normalized = y1 + t * (y2 - y1)

                planned_target = y_normalized * self.initial_target
                return max(0.0, planned_target)

        return 0.0
```

#### 5. Target æ›´æ–°é€»è¾‘ï¼ˆå®Œæ•´ç‰ˆï¼‰

```python
# æ¯ä¸€æ­¥ç”Ÿæˆ
predicted_embedding = model.forward(...)
predicted_value = embedding_to_value(predicted_embedding)

# è®¡ç®—è§„åˆ’çš„target
planned_target = 0.0
if planner:
    planned_target = planner.get_planned_target(total_tokens)

# æ ¹æ®æ§åˆ¶ç­–ç•¥é€‰æ‹©
if control_strategy == "full":
    next_target_value = planned_target
elif control_strategy == "partial" and step < compelling_steps:
    next_target_value = planned_target
else:
    next_target_value = predicted_value - 1

# å¦‚æœæœ‰ä¿®æ”¹è¯·æ±‚ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
if modify_request:
    next_target_value = modify_value

# è½¬æ¢ä¸º embedding
next_target_embedding = value_to_embedding(next_target_value)

# ä¸‹ä¸€æ­¥è¾“å…¥
input_target_embedding = next_target_embedding
```

#### 6. çº¿æ€§å›å½’ä¸ç»Ÿè®¡æŒ‡æ ‡

**çº¿æ€§å›å½’ï¼ˆæœ€å°äºŒä¹˜æ³•ï¼‰**:
```javascript
function linearRegression(x, y) {
    const n = x.length;
    let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;

    for (let i = 0; i < n; i++) {
        sumX += x[i];
        sumY += y[i];
        sumXY += x[i] * y[i];
        sumX2 += x[i] * x[i];
    }

    const a = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
    const b = (sumY - a * sumX) / n;

    return { a, b };  // y = b + a*x
}
```

**MSE è®¡ç®—**:
```javascript
function calculateMSE(x, y, a, b) {
    const n = x.length;
    let sumSquaredError = 0;

    for (let i = 0; i < n; i++) {
        const predicted = b + a * x[i];
        const error = y[i] - predicted;
        sumSquaredError += error * error;
    }

    return sumSquaredError / n;
}
```

**RÂ² è®¡ç®—**:
```javascript
function calculateR2(x, y, a, b) {
    const n = x.length;
    const meanY = y.reduce((sum, val) => sum + val, 0) / n;

    let ssRes = 0;  // æ®‹å·®å¹³æ–¹å’Œ
    let ssTot = 0;  // æ€»å¹³æ–¹å’Œ

    for (let i = 0; i < n; i++) {
        const predicted = b + a * x[i];
        ssRes += (y[i] - predicted) ** 2;
        ssTot += (y[i] - meanY) ** 2;
    }

    return 1 - (ssRes / ssTot);
}
```

**å‡å€¼ä¸æ–¹å·®**:
```javascript
function calculateMean(values) {
    return values.reduce((sum, val) => sum + val, 0) / values.length;
}

function calculateVariance(values) {
    const mean = calculateMean(values);
    const squaredDiffs = values.map(val => (val - mean) ** 2);
    return squaredDiffs.reduce((sum, val) => sum + val, 0) / values.length;
}
```

## ğŸ¨ ç•Œé¢é¢„è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ğŸš€ UnchartedLLM Chatbot                    â”‚
â”‚              å¯æ§é•¿åº¦æ–‡æœ¬ç”Ÿæˆ - å®æ—¶äº¤äº’å¼ç•Œé¢                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ è¾“å…¥é…ç½®          â”‚  ğŸ’¬ ç”Ÿæˆè¾“å‡º                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Prompt:         â”‚ â”‚  â”‚ Once upon a time, there was a  â”‚ â”‚
â”‚  â”‚ Once upon a timeâ”‚ â”‚  â”‚ beautiful princess who lived   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ in a castle...                 â”‚ â”‚
â”‚  Initial Target: 100 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  Max Length: 512     â”‚                                      â”‚
â”‚  Temperature: 1.0    â”‚  ğŸ” è¯¦ç»†ä¿¡æ¯                          â”‚
â”‚  [ğŸš€ å¼€å§‹ç”Ÿæˆ] [â¹ï¸åœæ­¢]â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                      â”‚  â”‚ [Step 42]                      â”‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ Token: "princess" (ID: 45678)  â”‚ â”‚
â”‚  ğŸ›ï¸ Target æ§åˆ¶      â”‚  â”‚ Input Target: 58.00            â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ Output Target: 57.23           â”‚ â”‚
â”‚  â”‚ Modify: 50      â”‚ â”‚  â”‚ Cosine: 0.9987                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  [âœï¸ Modify]         â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                      â”‚
â”‚  ğŸ¯ API æ§åˆ¶è§„åˆ’     â”‚                                      â”‚
â”‚  æ§åˆ¶ç­–ç•¥: [å…¨ç¨‹æ§åˆ¶]â”‚                                      â”‚
â”‚  æ§åˆ¶ç‚¹:             â”‚                                      â”‚
â”‚  [[0,1], [1,0]]     â”‚                                      â”‚
â”‚  ğŸ’¡ çº¿æ€§é€’å‡ k=-1    â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                      â”‚
â”‚  ğŸ“Š å®æ—¶ç»Ÿè®¡          â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                      â”‚
â”‚  â”‚ 42 â”‚   57.23    â”‚ â”‚                                      â”‚
â”‚  â”‚Tokenâ”‚  Target   â”‚ â”‚                                      â”‚
â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                                      â”‚
â”‚  â”‚0.9987â”‚   42     â”‚ â”‚                                      â”‚
â”‚  â”‚Cosineâ”‚  Step   â”‚ â”‚                                      â”‚
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ˆ è¾“å‡º Target æ›²çº¿    â”‚  ğŸ“‰ Cosine æ›²çº¿ + ç»Ÿè®¡             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   [æ—¶åºå›¾]       â”‚  â”‚  â”‚   [æ—¶åºå›¾]           â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                        â”‚  å‡å€¼: 0.998765  æ–¹å·®: 0.000012   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š Target vs Token    â”‚  ğŸ¯ è¾“å…¥ Target æ›²çº¿              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ [æ•£ç‚¹å›¾+æ‹Ÿåˆçº¿]  â”‚  â”‚  â”‚   [æ•£ç‚¹å›¾+è¿çº¿]      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  y = 99.82 - 0.99*x    â”‚  (ç»Ÿä¸€ X-Y æ¯”ä¾‹å°º)                â”‚
â”‚  MSE = 2.34            â”‚                                    â”‚
â”‚  RÂ² = 0.9988           â”‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š Predicted vs Input Target å¯¹æ¯”                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   [åŒçº¿å›¾: è“è‰²(Predicted) + ç»¿è‰²(Input)]            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  (ç»Ÿä¸€ X-Y æ¯”ä¾‹å°º)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: WebSocket è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: å‰ç«¯æ˜¾ç¤º "è¿æ¥æ–­å¼€"

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥åç«¯æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢ç«¯å£ 8765
3. æ£€æŸ¥ SSH ç«¯å£è½¬å‘æ˜¯å¦æ­£ç¡®è®¾ç½®

```bash
# æµ‹è¯•ç«¯å£æ˜¯å¦å¼€æ”¾
curl http://localhost:8765/health

# åº”è¯¥è¿”å›: {"status": "ok", "message": "Chatbot server is running"}
```

### é—®é¢˜ 2: æ¨¡å‹åŠ è½½å¤±è´¥

**ç—‡çŠ¶**: åç«¯å¯åŠ¨æ—¶æŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ¨¡å‹è·¯å¾„æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥æ¨¡å‹æ–‡ä»¶æ˜¯å¦å®Œæ•´
3. æ£€æŸ¥ GPU æ˜¾å­˜æ˜¯å¦è¶³å¤Ÿ

```bash
# æ£€æŸ¥ GPU æ˜¾å­˜
nvidia-smi

# å¦‚æœæ˜¾å­˜ä¸è¶³ï¼Œä½¿ç”¨ CPU
python backend.py --device cpu ...
```

### é—®é¢˜ 3: ç”Ÿæˆé€Ÿåº¦æ…¢

**ç—‡çŠ¶**: æ¯æ­¥ç”Ÿæˆè€—æ—¶è¿‡é•¿

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨ GPU è€Œä¸æ˜¯ CPU
2. å‡å° max_length
3. ä½¿ç”¨ bfloat16 ç²¾åº¦ (å·²é»˜è®¤å¯ç”¨)

### é—®é¢˜ 4: å‰ç«¯å›¾è¡¨ä¸æ˜¾ç¤º

**ç—‡çŠ¶**: ç”Ÿæˆç»“æŸåå›¾è¡¨åŒºåŸŸç©ºç™½

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ JavaScript é”™è¯¯
2. ç¡®ä¿ Chart.js CDN å¯è®¿é—®
3. åˆ·æ–°é¡µé¢é‡è¯•

### é—®é¢˜ 5: æ§åˆ¶ç‚¹æ ¼å¼é”™è¯¯

**ç—‡çŠ¶**: ç‚¹å‡»"å¼€å§‹ç”Ÿæˆ"åå¼¹å‡ºé”™è¯¯æç¤º

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ä½¿ç”¨ JSON æ•°ç»„æ ¼å¼ï¼š`[[x1, y1], [x2, y2], ...]`
2. æ¯ä¸ªç‚¹æ˜¯ä¸¤ä¸ªæ•°å­—çš„æ•°ç»„
3. x å€¼å¿…é¡»é€’å¢
4. y å€¼å»ºè®®åœ¨ [0, 1] èŒƒå›´å†…

**æ­£ç¡®ç¤ºä¾‹**:
```json
[[0, 1], [0.5, 0.5], [1, 0]]
```

**é”™è¯¯ç¤ºä¾‹**:
```json
[0, 1, 1, 0]  // é”™è¯¯ï¼šä¸æ˜¯äºŒç»´æ•°ç»„
[[1, 0], [0, 1]]  // é”™è¯¯ï¼šx å€¼æœªé€’å¢
```

### é—®é¢˜ 6: æ§åˆ¶ç­–ç•¥ä¸ç”Ÿæ•ˆ

**ç—‡çŠ¶**: ä½¿ç”¨æ§åˆ¶ç­–ç•¥åï¼ŒInput Target ä»ç„¶è·Ÿéš Predicted Target

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ§åˆ¶ç­–ç•¥æ˜¯å¦é€‰æ‹©æ­£ç¡®ï¼ˆä¸æ˜¯ "æ— æ§åˆ¶"ï¼‰
2. æ£€æŸ¥æ§åˆ¶ç‚¹æ˜¯å¦æ­£ç¡®è§£æï¼ˆæŸ¥çœ‹åç«¯æ—¥å¿—ï¼‰
3. å¦‚æœä½¿ç”¨ "éƒ¨åˆ†æ§åˆ¶"ï¼Œæ£€æŸ¥ compelling_steps æ˜¯å¦è®¾ç½®æ­£ç¡®
4. æŸ¥çœ‹å¯¹æ¯”å›¾ï¼Œç¡®è®¤ä¸¤æ¡çº¿æ˜¯å¦åˆ†ç¦»

## ğŸ“ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°åŠŸèƒ½

#### 1. æ·»åŠ æ–°çš„ç»Ÿè®¡æŒ‡æ ‡

ç¼–è¾‘ `backend.py`:

```python
@dataclass
class StepData:
    # æ·»åŠ æ–°å­—æ®µ
    new_metric: float
```

ç¼–è¾‘ `frontend.html`:

```javascript
// æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
function updateStats(data) {
    // æ·»åŠ æ–°æŒ‡æ ‡æ˜¾ç¤º
    document.getElementById('newMetric').textContent = data.new_metric;
}
```

#### 2. æ·»åŠ æ–°çš„æ§åˆ¶ç­–ç•¥

ç¼–è¾‘ `backend.py`:

```python
async def generate_step_by_step(...):
    # æ·»åŠ æ–°çš„æ§åˆ¶é€»è¾‘
    if control_strategy == 'custom':
        next_target_value = custom_function(predicted_value)
```

#### 3. æ·»åŠ æ–°çš„å¯è§†åŒ–å›¾è¡¨

ç¼–è¾‘ `frontend.html`:

```javascript
// æ·»åŠ æ–°å›¾è¡¨
function showNewChart() {
    const ctx = document.getElementById('newChart').getContext('2d');
    new Chart(ctx, {...});
}
```

#### 4. è‡ªå®šä¹‰æ§åˆ¶ç‚¹æ’å€¼æ–¹æ³•

å½“å‰ä½¿ç”¨çº¿æ€§æ’å€¼ï¼Œå¯ä»¥æ‰©å±•ä¸ºå…¶ä»–æ’å€¼æ–¹æ³•ï¼š

ç¼–è¾‘ `backend.py` ä¸­çš„ `TargetPlanner.get_planned_target()`:

```python
def get_planned_target(self, total_tokens):
    """æ”¯æŒå¤šç§æ’å€¼æ–¹æ³•"""
    x_normalized = total_tokens / self.initial_target

    if self.interpolation_method == 'linear':
        # çº¿æ€§æ’å€¼ï¼ˆå½“å‰å®ç°ï¼‰
        return self._linear_interpolation(x_normalized)
    elif self.interpolation_method == 'cubic':
        # ä¸‰æ¬¡æ ·æ¡æ’å€¼
        return self._cubic_interpolation(x_normalized)
    elif self.interpolation_method == 'exponential':
        # æŒ‡æ•°æ’å€¼
        return self._exponential_interpolation(x_normalized)
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. å‡å°‘ WebSocket ä¼ è¾“æ•°æ®é‡

å¦‚æœç”Ÿæˆé€Ÿåº¦å—ç½‘ç»œé™åˆ¶ï¼Œå¯ä»¥å‡å°‘ä¼ è¾“çš„å‘é‡ç»´åº¦ï¼š

```python
# backend.py
input_target_vector = current_target_embedding.detach().cpu().float().numpy()[:5].tolist()  # åªä¼ 5ç»´
```

#### 2. æ‰¹é‡å‘é€æ•°æ®

å¦‚æœå®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œå¯ä»¥æ‰¹é‡å‘é€ï¼š

```python
# æ¯10æ­¥å‘é€ä¸€æ¬¡
if step % 10 == 0:
    await websocket.send_json({...})
```

#### 3. ä½¿ç”¨æ›´å¿«çš„æ¨¡å‹

å¦‚æœé€Ÿåº¦æ˜¯ç“¶é¢ˆï¼Œè€ƒè™‘ï¼š
- ä½¿ç”¨é‡åŒ–æ¨¡å‹ï¼ˆINT8/INT4ï¼‰
- ä½¿ç”¨æ›´å°çš„æ¨¡å‹ï¼ˆå¦‚ Qwen2.5-3Bï¼‰
- ä½¿ç”¨ Flash Attention

### æ‰©å±•åŠŸèƒ½å»ºè®®

#### 1. ä¿å­˜å’ŒåŠ è½½æ§åˆ¶ç­–ç•¥

```python
# ä¿å­˜æ§åˆ¶ç­–ç•¥åˆ°æ–‡ä»¶
import json

strategy = {
    "name": "linear_decay",
    "control_points": [[0, 1], [1, 0]],
    "control_strategy": "full",
    "compelling_steps": 0
}

with open("strategies/linear_decay.json", "w") as f:
    json.dump(strategy, f)

# å‰ç«¯åŠ è½½é¢„è®¾ç­–ç•¥
function loadStrategy(name) {
    fetch(`/strategies/${name}.json`)
        .then(response => response.json())
        .then(strategy => {
            document.getElementById('controlPoints').value =
                JSON.stringify(strategy.control_points);
            document.getElementById('controlStrategy').value =
                strategy.control_strategy;
        });
}
```

#### 2. å¯¼å‡ºå®éªŒæ•°æ®

```javascript
// å¯¼å‡ºä¸º CSV
function exportToCSV() {
    const csv = historyData.map(d =>
        `${d.step},${d.total_tokens},${d.input_target_value},${d.output_target_value},${d.cosine_similarity}`
    ).join('\n');

    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'experiment_data.csv';
    a.click();
}
```

#### 3. å¤šå®éªŒå¯¹æ¯”

```javascript
// ä¿å­˜å¤šæ¬¡å®éªŒç»“æœ
let experiments = [];

function saveExperiment() {
    experiments.push({
        timestamp: Date.now(),
        prompt: document.getElementById('promptInput').value,
        initial_target: parseFloat(document.getElementById('initialTarget').value),
        history: historyData
    });
}

function compareExperiments() {
    // åœ¨åŒä¸€å›¾è¡¨ä¸­æ˜¾ç¤ºå¤šæ¬¡å®éªŒçš„ç»“æœ
    const datasets = experiments.map((exp, i) => ({
        label: `Experiment ${i+1}`,
        data: exp.history.map(d => d.output_target_value),
        borderColor: colors[i]
    }));

    new Chart(ctx, {
        type: 'line',
        data: { datasets }
    });
}
```

#### 4. å®æ—¶è°ƒæ•´æ§åˆ¶ç‚¹

```javascript
// ä½¿ç”¨å¯è§†åŒ–ç¼–è¾‘å™¨è°ƒæ•´æ§åˆ¶ç‚¹
function initControlPointEditor() {
    const canvas = document.getElementById('controlPointEditor');
    const ctx = canvas.getContext('2d');

    let points = [[0, 1], [1, 0]];

    canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) / canvas.width;
        const y = 1 - (e.clientY - rect.top) / canvas.height;

        points.push([x, y]);
        points.sort((a, b) => a[0] - b[0]);

        drawControlPoints(ctx, points);
        document.getElementById('controlPoints').value = JSON.stringify(points);
    });
}
```

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **ä¸è¦æš´éœ²åˆ°å…¬ç½‘**: é»˜è®¤ç»‘å®š `0.0.0.0`ï¼Œä»…ç”¨äº SSH ç«¯å£è½¬å‘
2. **ä½¿ç”¨ SSH éš§é“**: é€šè¿‡ SSH åŠ å¯†ä¼ è¾“æ•°æ®
3. **é™åˆ¶è®¿é—®**: å¯ä»¥ä¿®æ”¹ `HOST` ä¸º `127.0.0.1` ä»…å…è®¸æœ¬åœ°è®¿é—®

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [UnchartedLLM ä¸»æ–‡æ¡£](../README.md)
- [xVal ç¼–ç æ–¹æ¡ˆ](../core.py)
- [æ¨¡å‹æ¶æ„](../model.py)
- [æ¨ç†é€»è¾‘](../inference.py)

## ğŸ“ ä½¿ç”¨æŠ€å·§

### æŠ€å·§ 1: è§‚å¯Ÿ Cosine ç›¸ä¼¼åº¦

Cosine ç›¸ä¼¼åº¦åæ˜ äº†é¢„æµ‹ embedding ä¸ base embedding çš„æ–¹å‘ä¸€è‡´æ€§ï¼š

- **æ¥è¿‘ 1.0**: æ–¹å‘ä¸€è‡´ï¼Œé¢„æµ‹å‡†ç¡®
- **è¿œç¦» 1.0**: æ–¹å‘åç¦»ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´

**ç»Ÿè®¡æŒ‡æ ‡è§£è¯»**:
- **å‡å€¼æ¥è¿‘ 1.0**: æ•´ä½“é¢„æµ‹è´¨é‡é«˜
- **æ–¹å·®æ¥è¿‘ 0**: é¢„æµ‹ç¨³å®šæ€§å¥½

### æŠ€å·§ 2: åŠ¨æ€è°ƒæ•´ç­–ç•¥

æ ¹æ®ç”Ÿæˆå†…å®¹åŠ¨æ€è°ƒæ•´ targetï¼š

- **å†…å®¹è¿‡äºç®€çŸ­**: å¢åŠ  target å€¼
- **å†…å®¹è¿‡äºå†—é•¿**: å‡å°‘ target å€¼
- **éœ€è¦å¿«é€Ÿç»“æŸ**: è®¾ç½® target ä¸º 0

### æŠ€å·§ 3: å¯¹æ¯”å®éªŒ

è¿›è¡Œå¤šæ¬¡å®éªŒï¼Œå¯¹æ¯”ä¸åŒæ§åˆ¶ç­–ç•¥çš„æ•ˆæœï¼š

1. å›ºå®š target (ä¸ä¿®æ”¹)
2. ä¸­é€”å¢åŠ  target
3. ä¸­é€”å‡å°‘ target
4. å¤šæ¬¡ä¿®æ”¹ target

é€šè¿‡å›¾è¡¨å¯¹æ¯”ï¼Œæ‰¾åˆ°æœ€ä½³æ§åˆ¶ç­–ç•¥ã€‚

### æŠ€å·§ 4: ç†è§£æ‹Ÿåˆç›´çº¿

**æ‹Ÿåˆæ–¹ç¨‹ `y = b + a*x` çš„å«ä¹‰**:
- **æ–œç‡ a â‰ˆ -1**: æ¯è¾“å‡ºä¸€ä¸ª tokenï¼Œtarget å‡å°‘çº¦ 1ï¼ˆç†æƒ³çŠ¶æ€ï¼‰
- **æ–œç‡ a > -1**: target é€’å‡é€Ÿåº¦æ…¢äºé¢„æœŸ
- **æ–œç‡ a < -1**: target é€’å‡é€Ÿåº¦å¿«äºé¢„æœŸ
- **æˆªè· b â‰ˆ initial_target**: åˆå§‹ target å€¼å‡†ç¡®

**MSE å’Œ RÂ² çš„å«ä¹‰**:
- **MSE æ¥è¿‘ 0**: é¢„æµ‹è¯¯å·®å°ï¼Œé•¿åº¦æ§åˆ¶ç²¾ç¡®
- **RÂ² æ¥è¿‘ 1**: æ‹Ÿåˆæ•ˆæœå¥½ï¼Œæ¨¡å‹è¡Œä¸ºå¯é¢„æµ‹

### æŠ€å·§ 5: ä½¿ç”¨æ§åˆ¶ç‚¹è®¾è®¡ç­–ç•¥

**å¸¸ç”¨æ§åˆ¶ç‚¹æ¨¡å¼**:

1. **çº¿æ€§é€’å‡** `[[0, 1], [1, 0]]`
   - æœ€ç®€å•ï¼Œæ–œç‡ = -1
   - é€‚åˆéªŒè¯æ¨¡å‹åŸºæœ¬èƒ½åŠ›

2. **å¿«é€Ÿå¼€å§‹** `[[0, 1], [0.3, 0.5], [1, 0]]`
   - å‰ 30% å¿«é€Ÿé€’å‡
   - å 70% ç¼“æ…¢é€’å‡
   - é€‚åˆéœ€è¦å¿«é€Ÿè¿›å…¥ä¸»é¢˜çš„åœºæ™¯

3. **æ…¢é€Ÿå¼€å§‹** `[[0, 1], [0.7, 0.5], [1, 0]]`
   - å‰ 70% ç¼“æ…¢é€’å‡
   - å 30% å¿«é€Ÿé€’å‡
   - é€‚åˆéœ€è¦å……åˆ†é“ºå«çš„åœºæ™¯

4. **å¹³å°æœŸ** `[[0, 1], [0.2, 0.8], [0.8, 0.8], [1, 0]]`
   - ä¸­é—´ä¿æŒç¨³å®š target
   - é€‚åˆéœ€è¦ç»´æŒç‰¹å®šé•¿åº¦çš„åœºæ™¯

5. **å»¶é•¿ç”Ÿæˆ** `[[0, 1], [2, 0]]`
   - x è¶…è¿‡ 1ï¼Œå»¶é•¿ç”Ÿæˆæ—¶é—´
   - é€‚åˆéœ€è¦æ›´é•¿è¾“å‡ºçš„åœºæ™¯

### æŠ€å·§ 6: æ··åˆä½¿ç”¨æ§åˆ¶æ–¹å¼

å¯ä»¥åŒæ—¶ä½¿ç”¨è§„åˆ’æ§åˆ¶å’ŒåŠ¨æ€ä¿®æ”¹ï¼š

1. è®¾ç½®åŸºç¡€æ§åˆ¶ç­–ç•¥ï¼ˆå¦‚çº¿æ€§é€’å‡ï¼‰
2. åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­è§‚å¯Ÿè¾“å‡º
3. å¦‚æœéœ€è¦è°ƒæ•´ï¼Œä½¿ç”¨ Modify æŒ‰é’®å®æ—¶ä¿®æ”¹
4. åŠ¨æ€ä¿®æ”¹ä¼šè¦†ç›–è§„åˆ’æ§åˆ¶

### æŠ€å·§ 7: åˆ†æå¯¹æ¯”å›¾

**Predicted vs Input Target å¯¹æ¯”å›¾çš„è§£è¯»**:

- **ä¸¤çº¿é‡åˆ**: æœªä½¿ç”¨æ§åˆ¶ï¼Œæˆ–æ§åˆ¶ç­–ç•¥ä¸æ¨¡å‹é¢„æµ‹ä¸€è‡´
- **ä¸¤çº¿å¹³è¡Œ**: ä½¿ç”¨æ§åˆ¶ï¼Œä½†åç§»é‡å›ºå®š
- **ä¸¤çº¿äº¤å‰**: æ§åˆ¶ç­–ç•¥åœ¨æŸä¸ªæ—¶åˆ»æ”¹å˜
- **ç»¿çº¿çªå˜**: ä½¿ç”¨äº†åŠ¨æ€ä¿®æ”¹æˆ–åˆ‡æ¢äº†æ§åˆ¶ç­–ç•¥

### æŠ€å·§ 8: ä¼˜åŒ–æ§åˆ¶ç‚¹

**è¿­ä»£ä¼˜åŒ–æµç¨‹**:

1. **ç¬¬ä¸€æ¬¡**: ä½¿ç”¨ç®€å•çš„çº¿æ€§é€’å‡ `[[0, 1], [1, 0]]`
2. **è§‚å¯Ÿ**: æŸ¥çœ‹ Predicted Target çš„å®é™…èµ°åŠ¿
3. **è°ƒæ•´**: æ ¹æ®å®é™…èµ°åŠ¿è®¾è®¡æ–°çš„æ§åˆ¶ç‚¹
4. **ç¬¬äºŒæ¬¡**: ä½¿ç”¨ä¼˜åŒ–åçš„æ§åˆ¶ç‚¹
5. **å¯¹æ¯”**: æ¯”è¾ƒä¸¤æ¬¡å®éªŒçš„ RÂ² å’Œ MSE
6. **é‡å¤**: ç›´åˆ°æ‰¾åˆ°æœ€ä½³æ§åˆ¶ç­–ç•¥

### æŠ€å·§ 9: ç†è§£ç»Ÿä¸€æ¯”ä¾‹å°ºçš„é‡è¦æ€§

**ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€ X-Y æ¯”ä¾‹å°º**:

- ç›´è§‚çœ‹å‡ºæ–œç‡ï¼šk=-1 çš„ç›´çº¿åœ¨ç»Ÿä¸€æ¯”ä¾‹å°ºä¸‹æ˜¯ 45Â° è§’
- å‡†ç¡®è¯„ä¼°åå·®ï¼šç›¸åŒçš„æ•°å€¼åå·®åœ¨å›¾ä¸Šæœ‰ç›¸åŒçš„è§†è§‰è·ç¦»
- ä¾¿äºå¯¹æ¯”ï¼šä¸åŒå®éªŒçš„å›¾è¡¨å¯ä»¥ç›´æ¥å¯¹æ¯”

**å¦‚ä½•éªŒè¯æ¯”ä¾‹å°ºç»Ÿä¸€**:
- æŸ¥çœ‹å›¾è¡¨çš„ X è½´å’Œ Y è½´èŒƒå›´æ˜¯å¦ç›¸åŒ
- ç†æƒ³çš„çº¿æ€§é€’å‡åº”è¯¥æ˜¯ 45Â° æ–œçº¿

### æŠ€å·§ 10: éƒ¨åˆ†æ§åˆ¶ç­–ç•¥çš„åº”ç”¨

**ä½•æ—¶ä½¿ç”¨éƒ¨åˆ†æ§åˆ¶**:

- **å‰æœŸä¸¥æ ¼æ§åˆ¶ï¼ŒåæœŸè‡ªç”±å‘æŒ¥**: ç¡®ä¿å¼€å¤´ç¬¦åˆé¢„æœŸï¼Œç»“å°¾è®©æ¨¡å‹è‡ªç„¶æ”¶å°¾
- **æµ‹è¯•æ¨¡å‹é²æ£’æ€§**: è§‚å¯Ÿæ¨¡å‹åœ¨å¤±å»æ§åˆ¶åçš„è¡Œä¸º
- **å¹³æ»‘è¿‡æ¸¡**: é¿å…çªç„¶çš„æ§åˆ¶å˜åŒ–å¯¼è‡´ç”Ÿæˆè´¨é‡ä¸‹é™

**compelling_steps çš„é€‰æ‹©**:
- å¦‚æœ initial_target = 100ï¼Œå¯ä»¥è®¾ç½® compelling_steps = 50ï¼ˆå‰åŠæ®µæ§åˆ¶ï¼‰
- å¦‚æœå¸Œæœ›æ›´å¼ºçš„æ§åˆ¶ï¼Œå¢åŠ  compelling_steps
- å¦‚æœå¸Œæœ›æ›´å¤šè‡ªç”±åº¦ï¼Œå‡å°‘ compelling_steps

## ğŸ“§ åé¦ˆä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æŸ¥çœ‹ä¸»é¡¹ç›® README æˆ–æäº¤ issueã€‚

---

**ç‰ˆæœ¬**: 2.0.0
**æ—¥æœŸ**: 2026-01-28
**ä½œè€…**: UnchartedLLM Team

## ğŸ“‹ æ›´æ–°æ—¥å¿—

### v2.0.0 (2026-01-28)

**æ–°å¢åŠŸèƒ½**:
- âœ¨ API æ§åˆ¶è§„åˆ’åŠŸèƒ½ï¼šæ”¯æŒé€šè¿‡æ§åˆ¶ç‚¹å®šä¹‰ target è¾“å…¥ç­–ç•¥
- âœ¨ ä¸‰ç§æ§åˆ¶ç­–ç•¥ï¼šæ— æ§åˆ¶ã€éƒ¨åˆ†æ§åˆ¶ã€å…¨ç¨‹æ§åˆ¶
- âœ¨ TargetPlanner ç±»ï¼šçº¿æ€§æ’å€¼è®¡ç®—è§„åˆ’çš„ target å€¼
- âœ¨ æ–°å¢å›¾è¡¨ 3ï¼šTarget vs å·²è¾“å‡ºToken å…³ç³»å›¾ï¼ˆæ•£ç‚¹å›¾ + æ‹Ÿåˆç›´çº¿ï¼‰
- âœ¨ æ–°å¢å›¾è¡¨ 4ï¼šè¾“å…¥ Target å€¼æ›²çº¿
- âœ¨ æ–°å¢å›¾è¡¨ 5ï¼šPredicted vs Input Target å¯¹æ¯”å›¾
- âœ¨ ç»Ÿä¸€ X-Y è½´æ¯”ä¾‹å°ºï¼ˆ1:1ï¼‰ç¡®ä¿è§†è§‰å‡†ç¡®æ€§
- âœ¨ æ˜¾ç¤ºæ‹Ÿåˆæ–¹ç¨‹ã€MSE æŸå¤±ã€RÂ² å†³å®šç³»æ•°
- âœ¨ Cosine ç›¸ä¼¼åº¦ç»Ÿè®¡ï¼šå‡å€¼å’Œæ–¹å·®

**æ”¹è¿›**:
- ğŸ”§ StepData æ–°å¢å­—æ®µï¼šplanned_target_valueã€control_strategy
- ğŸ”§ å‰ç«¯æ–°å¢æ§åˆ¶ç‚¹è¾“å…¥æ¡†å’Œç­–ç•¥é€‰æ‹©å™¨
- ğŸ”§ åç«¯æ”¯æŒæ¥æ”¶å’Œå¤„ç†æ§åˆ¶å‚æ•°
- ğŸ”§ å®Œå–„çš„æ§åˆ¶é€»è¾‘ï¼šè§„åˆ’æ§åˆ¶ + åŠ¨æ€ä¿®æ”¹æ··åˆä½¿ç”¨

**æ–‡æ¡£**:
- ğŸ“š æ–°å¢ 7 ä¸ªä½¿ç”¨ç¤ºä¾‹ï¼ˆåŒ…å«æ§åˆ¶ç­–ç•¥ç¤ºä¾‹ï¼‰
- ğŸ“š æ–°å¢ 10 ä¸ªä½¿ç”¨æŠ€å·§
- ğŸ“š æ–°å¢æ§åˆ¶ç‚¹è®¾è®¡æ¨¡å¼
- ğŸ“š æ–°å¢æ•…éšœæ’æŸ¥æŒ‡å—
- ğŸ“š æ–°å¢å¼€å‘æ‰©å±•å»ºè®®

### v1.0.0 (2026-01-25)

**åˆå§‹ç‰ˆæœ¬**:
- ğŸ‰ åŸºç¡€ WebSocket å®æ—¶é€šä¿¡
- ğŸ‰ åŠ¨æ€ Target ä¿®æ”¹åŠŸèƒ½
- ğŸ‰ 2 ä¸ªåŸºç¡€å›¾è¡¨ï¼ˆTarget æ›²çº¿ã€Cosine æ›²çº¿ï¼‰
- ğŸ‰ å®æ—¶ç»Ÿè®¡é¢æ¿
- ğŸ‰ è¯¦ç»†ä¿¡æ¯å±•ç¤º

## ğŸ”— ç›¸å…³èµ„æº

### æ–‡æ¡£é“¾æ¥
- [UnchartedLLM ä¸»æ–‡æ¡£](../README.md)
- [xVal ç¼–ç æ–¹æ¡ˆ](../core.py)
- [æ¨¡å‹æ¶æ„](../model.py)
- [æ¨ç†é€»è¾‘](../inference.py)
- [è¯„ä¼°ç³»ç»Ÿ](../evaluation_index/README.md)

### ç¤ºä¾‹ä»£ç 
- [è®­ç»ƒè„šæœ¬](../train.py)
- [æ•°æ®é›†å¤„ç†](../dataset.py)

### è®ºæ–‡ä¸å‚è€ƒ
- UnchartedLLM: Controllable Length Text Generation with xVal Encoding
- Qwen2.5 Technical Report
- Transformer Architecture

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

### æŠ¥å‘Šé—®é¢˜
1. æ£€æŸ¥æ˜¯å¦å·²æœ‰ç›¸åŒé—®é¢˜
2. æä¾›è¯¦ç»†çš„å¤ç°æ­¥éª¤
3. é™„ä¸Šé”™è¯¯æ—¥å¿—å’Œæˆªå›¾
4. è¯´æ˜ç¯å¢ƒä¿¡æ¯ï¼ˆOSã€Python ç‰ˆæœ¬ã€GPU å‹å·ç­‰ï¼‰

### æäº¤ä»£ç 
1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. ç¼–å†™æ¸…æ™°çš„æäº¤ä¿¡æ¯
4. ç¡®ä¿ä»£ç é€šè¿‡æµ‹è¯•
5. æäº¤ Pull Request

### ä»£ç è§„èŒƒ
- Python: PEP 8
- JavaScript: ES6+
- æ³¨é‡Š: æ¸…æ™°çš„ä¸­è‹±æ–‡æ³¨é‡Š
- æ–‡æ¡£: æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ LICENSE æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹é¡¹ç›®å’Œå›¢é˜Ÿï¼š
- Qwen Team: æä¾›ä¼˜ç§€çš„åŸºç¡€æ¨¡å‹
- Hugging Face: Transformers åº“
- Chart.js: å¯è§†åŒ–åº“
- aiohttp: å¼‚æ­¥ Web æ¡†æ¶

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- GitHub Issues: [é¡¹ç›® Issues é¡µé¢]
- Email: [é¡¹ç›®é‚®ç®±]
- è®¨è®ºåŒº: [é¡¹ç›®è®¨è®ºåŒº]

---

**Happy Chatting! ğŸš€**
